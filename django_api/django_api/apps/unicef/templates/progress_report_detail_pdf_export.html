{% extends "easy_pdf/base.html" %}
{% load pdf_extras %}

{% block extra_style %}
    <style type="text/css">
        @page {
            size: a4 landscape;
            margin: 1cm;
        }

        #pdf {
            font-family: "Arial", "sans-serif";
            font-size: 10px;
        }
        h1 {
            font-family: "Arial", "sans-serif";
            font-size: 11px;
            font-weight: bold;
        }
        table, td, th {
            border: 1px solid black;
        }
        td, th {
            padding-top: 4px;
            padding-bottom: 1px;
            padding-left: 3px;
        }
        th {
            background-color: #d9d9d9;
            font-weight: normal;
            text-align: left;
        }
        th.section {
            background-color: #2498FA;
            font-weight: bold;
            color: #ffffff;
            text-align: left;
        }
        td.signature {
            font-size: 12px;
            font-weight: bold;
        }

        td.Met, td.OnT {
            background-color: #92D050;
        }

        td.NoP {
            background-color: #E93F33;
        }

        td.Con {
            background-color: #B2A1C7;
        }

        .center {
            text-align: center;
        }

    </style>
{% endblock %}

{% block content %}
    <div id="pdf">
        <h1>{{ title }}</h1>
        <table>
            <tr>
                <th colspan="4" class="section">Section 1. Programme & Report overview</th>
            </tr>
            {% render_base_programme_info_for_report progress_report %}

            <tr>
                <th rowspan="8">
                    1.3 Progress Report Information
                </th>
                <th>Status</th>
                <td colspan="2">{{ progress_report.get_status_display }}</td>
            </tr>
            <tr>
                <th>Due Date</th>
                <td colspan="2">{{ progress_report.due_date }}</td>
            </tr>
            <tr>
                <th>Submission Date</th>
                <td colspan="2">{{ progress_report.submission_date|default:"---" }}</td>
            </tr>
            <tr>
                <th>Submitted By</th>
                <td colspan="2">{{ progress_report.submitted_by.display_name|default:"---" }}</td>
            </tr>
            <tr>
                <th>Partner Contribution to Date</th>
                <td colspan="2">{{ progress_report.partner_contribution_to_date|default:"---" }}</td>
            </tr>
            <tr>
                <th>Challenges / Bottlenecks in the Reporting Period</th>
                <td colspan="2">{{ progress_report.challenges_in_the_reporting_period|default:"---" }}</td>
            </tr>
            <tr>
                <th>Proposed Way Forward</th>
                <td colspan="2">{{ progress_report.proposed_way_forward|default:"---" }}</td>
            </tr>
            <tr>
                <th>Attachment</th>
                <td colspan="2">{% get_absolute_file_url progress_report.attachment %}</td>
            </tr>
        </table>

        <div>
            <pdf:nextpage />
        </div>

        <table>
            <tr>
                <th class="section center">2. Lower Level Outputs</th>
            </tr>
        </table>
        <br />

        <table>
            <tr>
                <th>Programme Outputs*</th>
                <th>Performance indicator*</th>
                <th>Targets*</th>
                <th>Achievement in reporting period**</th>
                <th>Cumulative progress to date**</th>
                <th>Overall Status</th>
                <th>Narrative assessment / summary of progress**</th>
            </tr>
            {% for report_list in indicator_reports %}
                {% for indicator in report_list %}
                    {% if forloop.counter == 1 %}
                        <tr>
                            <th rowspan="{{ report_list|length }}">{{ indicator.reportable.content_object.title }}</th>
                            <th>{{ indicator.title }}</th>
                            <th>{{ indicator.reportable.target }}</th>
                            <td width="100px">{% if indicator.is_number %}{{ indicator.total.v|floatformat:"0" }}{% else %}{{ indicator.total.c|percentage }}{% endif %}</td>
                            <td width="100px">{% if indicator.is_number %}{{ indicator.total.v|floatformat:"0" }}{% else %}{{ indicator.total.c|percentage }}{% endif %}</td>
                            <td rowspan="{{ report_list|length }}" class="{{ indicator.overall_status }}">
                                {{ indicator.get_overall_status_display }}
                            </td>
                            <td rowspan="{{ report_list|length }}">
                                {{ indicator.narrative_assessment|default:"---" }}
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <th>{{ indicator.title }}</th>
                            <th>{{ indicator.reportable.target }}</th>
                            <td>{% if indicator.is_number %}{{ indicator.total.v|floatformat:"0" }}{% else %}{{ indicator.total.c|percentage }}{% endif %}</td>
                            <td>{% if indicator.is_number %}{{ indicator.total.v|floatformat:"0" }}{% else %}{{ indicator.total.c|percentage }}{% endif %}</td>
                        </tr>
                    {% endif %}
                {% endfor %}
            {% endfor %}
        </table>

    </div>
{% endblock %}
