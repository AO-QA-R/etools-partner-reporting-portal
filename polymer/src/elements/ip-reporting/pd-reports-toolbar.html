<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../../bower_components/iron-location/iron-location.html">

<link rel="import" href="../../endpoints.html">
<link rel="import" href="../../redux/store.html">
<link rel="import" href="../../styles/buttons.html">

<dom-module id="pd-reports-toolbar">
  <template>
    <style include="iron-flex iron-flex-reverse button-styles">
      :host {
        display: block;
        margin: 1em 0;
      }

      a {
        text-decoration: none;
        color: var(--theme-primary-color);
      }
    </style>

    <iron-location
      query="{{query}}">
    </iron-location>

    <div class="layout horizontal-reverse">
      <a
          href="[[xlsExportUrl]]"
          tabindex="-1"
          target="_blank">
        <paper-button class="btn-primary">
          <iron-icon icon="icons:file-download"></iron-icon>
          XLS
        </paper-button>
      </a>
      <a
          href="[[pdfExportUrl]]"
          tabindex="-1"
          target="_blank">
        <paper-button class="btn-primary">
          <iron-icon icon="icons:file-download"></iron-icon>
          PDF
        </paper-button>
      </a>
    </div>
  </template>

  <script>
    Polymer({
      is: 'pd-reports-toolbar',

      behaviors: [
        App.Behaviors.ReduxBehavior,
      ],

      properties: {
        query: String,

        pdId: {
          type: String,
          statePath: 'programmeDocuments.current',
        },

        locationId: {
          type: String,
          statePath: 'location.id',
        },

        fullQuery: {
          type: Object,
          computed: '_computeFullQuery(pdId, query)',
        },

        xlsExportUrl: {
          type: String,
          computed: '_computeExportUrl(locationId, fullQuery, "xlsx")',
        },

        pdfExportUrl: {
          type: String,
          computed: '_computeExportUrl(locationId, fullQuery, "pdf")',
        },

      },

      _computeFullQuery: function (pdId, query) {
        return query + '&programme_document=' + pdId;
      },

      _computeExportUrl: function (locationId, fullQuery, filetype) {
        return [
          App.Endpoints.programmeDocumentReports(locationId),
          '?',
          fullQuery,
          '&export=',
          filetype
        ].join('');
      },
    });
  </script>
</dom-module>
