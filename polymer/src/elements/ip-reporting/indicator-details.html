<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="../etools-prp-ajax.html">
<link rel="import" href="../../elements/disaggregations/disaggregation-table.html">
<link rel="import" href="../../endpoints.html">

<dom-module id="ip-reporting-indicator-details">
  <template>
    <style include="iron-flex iron-flex-factors">
      :host {
        display: block;
      }
      iron-icon {
        color: var(--accent-color)
      }
      h3 {
        width: 100%;
        float: left;
      }
      h4 {
        font-weight: 400;
      }
      h4 span {
        color: gray;
        font-weight: 400;
      }
      .wrapper {
        float: left;
        margin: 0 10px 10px 10px;
        width: 100%;
      }
    </style>

    <etools-prp-ajax
        id="indicatorDetail"
        url="[[indicatorDetailUrl]]">
    </etools-prp-ajax>

    <etools-loading active="[[loading]]"></etools-loading>

    <!-- TODO: group data objects by location; only display location header once. -->
    <template is="dom-repeat"
              items="[[data]]">
      <template is="dom-repeat"
                items="[[item.indicator_location_data]]"
                as="location">
        <h3>
          <iron-icon icon="maps:place"></iron-icon>[[location.location.title]]
        </h3>

        <!-- TODO: handle multiple tables for the same location. -->
        <div class="wrapper">
          <h4>
            Progress in reporting period
            <span>[[item.time_period_start]] - [[item.time_period_end]]<span>
          </h4>
          <disaggregation-table data=[[location]]
                                mapping=[[item.disagg_lookup_map]]>
          </disaggregation-table>
        </div>

      </template>
    </template>
  </template>

  <script>

    Polymer({
      is: 'ip-reporting-indicator-details',

      properties: {
        indicatorDetailUrl: {
          type: String,
          computed: '_computeIndicatorReportsUrl(indicatorId)',
        },

        isOpen: {
          type: Boolean,
          observer: '_openChanged',
        },

        indicatorId: Number,

        loading: Boolean,

        data: {
          type: Object,
          value:



              [{
                  "id": 156,
                  "title": "indicator_report_1",
                  "indicator_location_data": [
                      {
                          "id": 106,
                          "location": {
                              "id": 147,
                              "title": "location_2",
                              "latitude": null,
                              "longitude": null,
                              "p_code": null
                          },
                          "disaggregation": {
                              "(868, 869, 873)": 184,
                              "(869, 872, 875)": 51,
                              "(871, 872, 878)": 176,
                              "(869, 872, 878)": 146,
                              "(873, 875, 878)": 143,
                              "(876,)": 51,
                              "(868, 871, 876)": 95,
                              "(872, 876)": 120,
                              "(873, 876, 878)": 55,
                              "(870, 875, 876)": 99,
                              "(871, 873, 878)": 106,
                              "(870, 872, 877)": 141,
                              "(868, 871)": 145,
                              "(870, 875)": 164,
                              "(874, 876, 878)": 134,
                              "(868, 873, 875)": 137,
                              "(868, 872, 876)": 149,
                              "(873, 878)": 148,
                              "(871, 872, 877)": 174,
                              "(874, 876, 877)": 98,
                              "(869, 870, 875)": 81,
                              "(874, 875, 878)": 109,
                              "(869, 871, 873)": 91,
                              "(868, 870, 876)": 90,
                              "(871, 874, 876)": 161,
                              "(869, 873)": 80,
                              "(872, 873, 877)": 88,
                              "(871, 878)": 162,
                              "(876, 877, 878)": 137,
                              "(869, 872, 874)": 154,
                              "(870, 873, 876)": 68,
                              "(874, 877, 878)": 61,
                              "(868, 872, 873)": 160,
                              "(868, 878)": 103,
                              "(870, 872)": 194,
                              "(868, 869, 870)": 145,
                              "(870, 873, 877)": 132,
                              "(875, 877)": 115,
                              "()": 148,
                              "(872, 874, 877)": 59,
                              "(873, 874, 878)": 127,
                              "(871, 873)": 181,
                              "(872, 877)": 182,
                              "(870, 872, 876)": 148,
                              "(868, 871, 875)": 154,
                              "(878,)": 150,
                              "(870, 871, 873)": 184,
                              "(868, 873, 874)": 81,
                              "(869, 871, 878)": 168,
                              "(872, 875, 877)": 172,
                              "(873, 877, 878)": 80,
                              "(869, 870, 874)": 74,
                              "(873, 877)": 76,
                              "(868, 874, 875)": 122,
                              "(871, 877, 878)": 79,
                              "(877, 878)": 100,
                              "(868, 870, 877)": 185,
                              "(868, 869, 878)": 170,
                              "(871, 874, 877)": 102,
                              "(871, 873, 877)": 69,
                              "(868, 876, 877)": 166,
                              "(873, 874, 875)": 61,
                              "(869, 874)": 106,
                              "(874, 878)": 173,
                              "(872, 875, 878)": 106,
                              "(870, 873)": 152,
                              "(870, 875, 878)": 152,
                              "(868, 869, 871)": 129,
                              "(869,)": 198,
                              "(872, 874, 876)": 75,
                              "(875, 876)": 121,
                              "(870, 871, 874)": 95,
                              "(868, 871, 874)": 136,
                              "(876, 877)": 192,
                              "(868, 870)": 116,
                              "(870, 875, 877)": 162,
                              "(873, 876)": 183,
                              "(870, 873, 878)": 122,
                              "(868, 873, 877)": 80,
                              "(869, 874, 875)": 145,
                              "(869, 873, 874)": 84,
                              "(869, 870, 877)": 109,
                              "(871, 873, 876)": 90,
                              "(869, 872, 873)": 191,
                              "(868, 876, 878)": 162,
                              "(869, 875)": 193,
                              "(868, 870, 878)": 51,
                              "(871, 875, 878)": 120,
                              "(869, 876)": 50,
                              "(873, 874, 877)": 195,
                              "(871, 875)": 149,
                              "(868, 871, 873)": 145,
                              "(869, 875, 878)": 178,
                              "(870, 871, 872)": 87,
                              "(870, 871, 875)": 156,
                              "(868, 874, 878)": 187,
                              "(870, 872, 873)": 103,
                              "(877,)": 137,
                              "(868, 870, 871)": 67,
                              "(868, 877)": 136,
                              "(868, 873, 876)": 168,
                              "(868, 872, 878)": 125,
                              "(873, 875)": 66,
                              "(869, 871, 876)": 156,
                              "(868, 871, 877)": 128,
                              "(869, 873, 875)": 156,
                              "(872, 873, 878)": 117,
                              "(876, 878)": 114,
                              "(870, 878)": 75,
                              "(870, 874, 877)": 110,
                              "(872, 878)": 88,
                              "(868, 869, 876)": 64,
                              "(871, 874, 875)": 88,
                              "(868, 869)": 146,
                              "(868, 877, 878)": 157,
                              "(869, 876, 878)": 99,
                              "(868, 873, 878)": 111,
                              "(869, 877)": 65,
                              "(871, 874)": 71,
                              "(874, 876)": 103,
                              "(868, 871, 872)": 199,
                              "(872, 875, 876)": 73,
                              "(870, 871)": 59,
                              "(872,)": 79,
                              "(870,)": 82,
                              "(875, 878)": 111,
                              "(873, 874, 876)": 162,
                              "(872, 874, 878)": 154,
                              "(871, 872, 874)": 160,
                              "(868, 870, 872)": 96,
                              "(871, 876, 877)": 71,
                              "(868, 876)": 91,
                              "(869, 870, 871)": 108,
                              "(869, 874, 877)": 128,
                              "(871, 872, 873)": 151,
                              "(869, 871, 877)": 97,
                              "(870, 873, 874)": 142,
                              "(870, 876, 878)": 134,
                              "(873, 874)": 198,
                              "(870, 874, 876)": 128,
                              "(869, 873, 876)": 146,
                              "(868, 869, 877)": 68,
                              "(871, 873, 874)": 148,
                              "(870, 872, 878)": 188,
                              "(868, 872, 877)": 106,
                              "(868, 875, 877)": 102,
                              "(873, 875, 876)": 74,
                              "(874, 877)": 154,
                              "(868,)": 70,
                              "(869, 878)": 95,
                              "(871, 877)": 81,
                              "(869, 876, 877)": 61,
                              "(875, 876, 877)": 113,
                              "(869, 877, 878)": 142,
                              "(869, 873, 878)": 191,
                              "(870, 876)": 83,
                              "(871, 872, 875)": 124,
                              "(870, 871, 876)": 54,
                              "(872, 876, 878)": 109,
                              "(869, 871, 874)": 105,
                              "(868, 875)": 107,
                              "(868, 875, 878)": 121,
                              "(870, 872, 875)": 100,
                              "(871, 876, 878)": 151,
                              "(868, 870, 873)": 180,
                              "(870, 874, 875)": 55,
                              "(874,)": 134,
                              "(869, 870)": 128,
                              "(869, 874, 876)": 189,
                              "(868, 869, 874)": 173,
                              "(872, 873, 876)": 74,
                              "(869, 873, 877)": 156,
                              "(869, 870, 878)": 138,
                              "(870, 873, 875)": 85,
                              "(868, 872, 874)": 56,
                              "(870, 874, 878)": 164,
                              "(868, 875, 876)": 53,
                              "(868, 869, 875)": 55,
                              "(871, 876)": 83,
                              "(872, 874)": 139,
                              "(870, 877)": 182,
                              "(873, 876, 877)": 83,
                              "(872, 873, 874)": 130,
                              "(871, 872, 876)": 56,
                              "(869, 874, 878)": 176,
                              "(868, 873)": 115,
                              "(871, 874, 878)": 98,
                              "(871,)": 70,
                              "(869, 870, 873)": 114,
                              "(871, 873, 875)": 116,
                              "(870, 871, 877)": 167,
                              "(874, 875, 876)": 114,
                              "(872, 873)": 130,
                              "(869, 875, 877)": 78,
                              "(871, 875, 877)": 77,
                              "(868, 870, 874)": 128,
                              "(868, 874)": 93,
                              "(869, 871)": 80,
                              "(869, 875, 876)": 142,
                              "(869, 870, 876)": 139,
                              "(871, 872)": 164,
                              "(870, 876, 877)": 53,
                              "(869, 871, 875)": 111,
                              "(869, 872, 877)": 184,
                              "(868, 871, 878)": 100,
                              "(868, 869, 872)": 50,
                              "(872, 877, 878)": 68,
                              "(872, 874, 875)": 200,
                              "(868, 874, 877)": 177,
                              "(873, 875, 877)": 123,
                              "(868, 872, 875)": 148,
                              "(872, 875)": 141,
                              "(870, 872, 874)": 153,
                              "(874, 875)": 197,
                              "(872, 873, 875)": 59,
                              "(875, 877, 878)": 170,
                              "(868, 872)": 71,
                              "(870, 874)": 197,
                              "(871, 875, 876)": 169,
                              "(875, 876, 878)": 175,
                              "(874, 875, 877)": 97,
                              "(872, 876, 877)": 82,
                              "(873,)": 59,
                              "(870, 877, 878)": 130,
                              "(868, 870, 875)": 143,
                              "(870, 871, 878)": 181,
                              "(869, 870, 872)": 150,
                              "(868, 874, 876)": 121,
                              "(869, 871, 872)": 153,
                              "(869, 872)": 105,
                              "(869, 872, 876)": 182,
                              "(875,)": 176
                          },
                          "num_disaggregation": 3,
                          "level_reported": 3,
                          "disaggregation_reported_on": [
                              266,
                              267,
                              268
                          ]
                      }
                  ],
                  "time_period_start": "2017-06-13",
                  "time_period_end": "2017-06-13",
                  "total": 1900,
                  "remarks": null,
                  "report_status": "OT",




                  "disagg_lookup_map": [
                      {
                          "id": 266,
                          "name": "height",
                          "active": true,
                          "choices": [
                              {
                                  "id": 868,
                                  "value": "tall",
                                  "active": true
                              },
                              {
                                  "id": 869,
                                  "value": "medium",
                                  "active": true
                              },
                              {
                                  "id": 870,
                                  "value": "short",
                                  "active": true
                              },
                              {
                                  "id": 871,
                                  "value": "extrashort",
                                  "active": true
                              }
                          ]
                      },
                      {
                          "id": 267,
                          "name": "age",
                          "active": true,
                          "choices": [
                              {
                                  "id": 872,
                                  "value": "1-2m",
                                  "active": true
                              },
                              {
                                  "id": 873,
                                  "value": "3-4m",
                                  "active": true
                              },
                              {
                                  "id": 874,
                                  "value": "5-6m",
                                  "active": true
                              },
                              {
                                  "id": 875,
                                  "value": "7-10m",
                                  "active": true
                              }
                          ]
                      },
                      {
                          "id": 268,
                          "name": "gender",
                          "active": true,
                          "choices": [
                              {
                                  "id": 876,
                                  "value": "male",
                                  "active": true
                              },
                              {
                                  "id": 877,
                                  "value": "female",
                                  "active": true
                              },
                              {
                                  "id": 878,
                                  "value": "other",
                                  "active": true
                              }
                          ]
                      }
                  ],




                  "disagg_choice_lookup_map": [
                      [
                          [
                              876,
                              "male"
                          ],
                          [
                              877,
                              "female"
                          ],
                          [
                              878,
                              "other"
                          ]
                      ],
                      [
                          [
                              868,
                              "tall"
                          ],
                          [
                              869,
                              "medium"
                          ],
                          [
                              870,
                              "short"
                          ],
                          [
                              871,
                              "extrashort"
                          ]
                      ],
                      [
                          [
                              872,
                              "1-2m"
                          ],
                          [
                              873,
                              "3-4m"
                          ],
                          [
                              874,
                              "5-6m"
                          ],
                          [
                              875,
                              "7-10m"
                          ]
                      ]
                  ]
              }]







        }
      },

      _computeIndicatorReportsUrl: function (indicatorId) {
        return App.Endpoints.indicatorReports(indicatorId);
      },

      _openChanged: function () {
        var self = this;
        if (this.isOpen) {
          self.loading = true;
          this.$.indicatorDetail.thunk()()
            .then(function (res) {
              // TODO: remove dummy data and uncomment.
              // self.data = res.data;
              self.loading = false;
            });
            // TODO: error handling.
        } else {
          this.$.indicatorDetail.abort();
        }
      }

    });
  </script>
</dom-module>
