<link rel="import" href="../../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../../../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="../../endpoints.html">
<link rel="import" href="../../elements/etools-prp-ajax.html">
<link rel="import" href="../../elements/etools-prp-detail-table.html">
<link rel="import" href="../../behaviors/utils.html">

<dom-module id="ip-reporting-indicator-details">
  <template>
    <style include="iron-flex iron-flex-factors">
      :host {
        display: block;
      }
      iron-icon {
        color: var(--accent-color)
      }
      h3 {
        width: 100%;
        float: left;
      }
      h4 {
        font-weight: 400;
      }
      h4 span {
        color: gray;
        font-weight: 400;
      }
      .wrapper {
        float: left;
        margin: 0 10px 10px 10px;
      }
    </style>

    <etools-prp-ajax
        id="indicatorDetail"
        url="[[indicatorDetailUrl]]">
    </etools-prp-ajax>

    <!-- Data will contain a list of objects, each representing a different location. -->
    <template id="reports"
              is="dom-repeat"
              items="[[data]]">
      <h3>
        <iron-icon icon="maps:place"></iron-icon>
        [[item.indicator_location_data.0.location.title]]
      </h3>

      <template id="report-table"
                is="dom-repeat"
                items="[[item.indicator_location_data]]"
                as="report">
        <div class="wrapper">
          <h4>
            Progress in reporting period
            <span>[[item.time_period_start]] - [[item.time_period_end]]<span>
          </h4>
          <etools-prp-detail-table report=[[report]]></etools-prp-detail-table>
        </div>
      </template>
    </template>
  </template>

  <script>
    Polymer({
      is: 'ip-reporting-indicator-details',

      behaviors: [
        App.Behaviors.UtilsBehavior,
      ],

      properties: {
        indicatorDetailUrl: {
          type: String,
          computed: '_computeIndicatorReportsUrl(indicatorId)',
        },

        indicatorId: Number,

        data: {
          type: Array,
          value: []
        }
      },

      _computeIndicatorReportsUrl: function (indicatorId) {
        return App.Endpoints.indicatorReports(indicatorId);
      },

      attached: function () {
        var self = this;

        this.$.indicatorDetail.thunk()()
          .then(function (res) {
            self.data = res.data;
            // Each returns a list of report with a different time period.
            // TODO: sort on the frontend by location.
            console.log(res.data)
          })
      },

      detached: function () {
        this.$.indicatorDetail.abort();
      }
    });
  </script>
</dom-module>
