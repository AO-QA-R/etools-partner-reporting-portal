<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../redux/store.html">
<link rel="import" href="../../behaviors/routing.html">
<link rel="import" href="../../behaviors/page-nav.html">
<link rel="import" href="../../behaviors/utils.html">
<link rel="import" href="../../behaviors/routing.html">

<dom-module id="change-response-plan">
  <template>
    <style>
      :host {
        display: block;
        float: left;
        margin: auto 30px;
        height: 64px;
        line-height: 64px;

        color: var(--theme-primary-text-color-medium);
        font-size: 15px;
        font-weight: 200;
      }

      a {
        color: var(--theme-primary-color-cluster-bright);
        font-size: 13px;
      }
    </style>

    <span>[[currentPlanTitle]]</span>
    <a on-tap="_change" href="[[url]]">change</a>
  </template>

  <script>
    Polymer({
      is: 'change-response-plan',

      behaviors: [
        App.Behaviors.ReduxBehavior,
        App.Behaviors.PageNavBehavior,
        App.Behaviors.UtilsBehavior,
        App.Behaviors.RoutingBehavior,
      ],

      properties: {
        responsePlans: {
          type: Array,
          statePath: 'responsePlans.all',
        },

        responsePlanID: {
          type: String,
          statePath: 'responsePlans.currentID',
        },

        currentPlanTitle: {
          type: 'String',
          computed: '_getCurrentPlanTitle(responsePlans, responsePlanID)'
        },

        url: String,
      },

      attached: function() {
        this.url = this._formatUrl();
        this._getCurrentPlanTitle();
      },

      _getCurrentPlanTitle: function() {
        var self = this;
        var title = '';
        this.responsePlans.forEach(function(plan) {
          if (String(plan.id) === self.responsePlanID) {
            title = plan.title;
          }
        });
        return title;
      },

      _formatUrl: function() {
        var previous = this.responsePlanID;
        var url = this.buildUrl(this.baseUrl, 'select-plan');
        if (previous && previous !== 'undefined') {
          return url + '?previous=' + previous;
        }
        return url;
      },

      _change: function() {
        this.dispatch(App.Actions.setCurrentResponsePlanID('select-plan'));
      }
    });
  </script>
</dom-module>
