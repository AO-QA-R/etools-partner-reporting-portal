<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">

<link rel="import" href="../../polyfills/es6-shim.html">
<link rel="import" href="../../behaviors/utils.html">
<link rel="import" href="../etools-prp-chips.html">
<link rel="import" href="chip-disagg-value.html">
<link rel="import" href="../../styles/buttons.html">

<dom-module id="disaggregation-dropdown-widget">
  <template>
    <style include="button-styles iron-flex iron-flex-alignment">
      :host {
        display: block;
      }

      h2 {
        padding: 5px 10px;
        margin: 0 0 1em;
        font-size: 14px;
        background-color: var(--paper-grey-200);
      }

      .error,
      .remove-btn {
        color: var(--paper-deep-orange-a700);
      }

      .rowDis {
        margin-bottom: 1em;
      }

      .remove-btn {
        width: 34px;
        height: 34px;
      }

      .add-disaggregation-btn {
        margin: 0;
      }

      .col-actions {
        width: 40px;
        border-right: 1px solid var(--paper-grey-400);
      }

      .col-name,
      .col-values {
        padding-left: 24px;
      }
    </style>

    <h2>Disaggregations ([[dis.length]])</h2>

    <div class="item">

      <template is="dom-repeat" items="[[dis]]" as="dataDisagg">

        <div class="rowDis layout horizontal"">

          <div class="flex-none layout vertical center-center col-actions">
            <paper-icon-button
              index="[[index]]"
              class="remove-btn"
              on-tap="_remove"
              icon="icons:cancel">
            </paper-icon-button>
          </div>

          <div class="col-name">
            <paper-dropdown-menu
              class="dis-menu validate"
              id="disaggregationsDrop"
              index="[[index]]"
              label="Disaggregation By"
              on-value-changed="_validate"
              on-selected-item-changed="_setDisaggregation"
              always-float-label
              required>
              <paper-listbox
                slot="dropdown-content"
                class="dropdown-content">
                <template
                  is="dom-repeat"
                  items="[[disaggregations]]">
                  <paper-item name="[[item.id]]">[[item.name]]</paper-item>
                </template>
              </paper-listbox>
            </paper-dropdown-menu>
          </div>
        
          <div class="col-values">
            <paper-input
              index="[[index]]"
              label="Disaggregation Groups"
              value="[[_formatChoices(dataDisagg, index)]]"
              always-float-label
              disabled>
            </paper-input>
          </div>

        </div>
      </template>

    </div>
    <paper-button
      class="btn-primary add-disaggregation-btn"
      on-tap="_add"
      disabled="[[!_canAddMore]]">
      Add disaggregation
    </paper-button>

  </template>
  <script>
    Polymer({
      id: 'disaggregation-dropdown-widget',

      behaviors: [
        App.Behaviors.UtilsBehavior,
      ],

      properties: {
        dis: {
          type: Array,
          value: [],
          notify: true,
        },
        invalid: {
          type: Boolean,
          notify: true,
          value: true
        },
        canAddMore: {
          type: Boolean,
          value: true,
        },

        _invalid: {
          type: Boolean,
          value: false,
        },

        _headingClassName: {
          type: String,
          computed: '_computeHeadingClassName(_invalid)',
        },
      },

      observers: [

      ],

      _computeHeadingClassName: function (invalid) {
        return invalid ? 'error' : '';
      },

    })

