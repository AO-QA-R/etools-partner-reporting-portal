<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-menu/paper-submenu.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">

<link rel="import" href="../behaviors/utils.html">

<dom-module id="page-nav">
  <template>
    <style>
      :host {
        display: block;

        --paper-item-selected: {
          color: var(--theme-primary-color);
          background: var(--theme-selected-item-background-color);
        };

        --paper-item-focused-before: {
          background: transparent;
        };

        --paper-menu-focused-item-after: {
          background: transparent;
        };

        /*
        Normal?

        --paper-item-selected-weight: normal;

        --paper-menu-selected-item: {
          font-weight: normal;
        };
        */
      }

      a {
        @apply(--layout);
        @apply(--layout-vertical);
        @apply(--layout-center-justified);

        color: inherit;
        text-decoration: none;
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        padding: 0 16px;
      }

      .menu-trigger {
        --paper-item-selected: {
          color: inherit;
          background: var(--theme-selected-item-background-color);
        };
      }

      .menu-content {
        padding-top: 0;
        background: var(--theme-selected-item-background-color);
      }

      .menu-content paper-item {
        --paper-item: {
          min-height: 32px;
          font-size: 12px;
        };
      }

      .menu-content a {
        padding-left: 32px;
      }
    </style>

    <paper-menu
        id="menu"
        selected="{{selected}}"
        attr-for-selected="name"
        selectable="paper-item"
        key-event-target="null">

      <paper-item name="dashboard">
        <a href="/app/dashboard">
          <span>Dashboard</span>
        </a>
      </paper-item>

      <paper-item name="interventions">
        <a href="/app/interventions">
          <span>Interventions</span>
        </a>
      </paper-item>

      <paper-submenu>
        <paper-item
            class="menu-trigger">
          <a href="/app/activity-reports">
            <span>Reporting</span>
          </a>
        </paper-item>

        <paper-menu
            class="menu-content"
            selected="{{selected}}"
            attr-for-selected="name"
            selectable="paper-item"
            key-event-target="null">
          <paper-item name="activity-reports">
            <a href="/app/activity-reports">
              <span>Activity reports</span>
            </a>
          </paper-item>

          <paper-item name="project-reports">
            <a href="/app/project-reports">
              <span>Project reports</span>
            </a>
          </paper-item>

          <paper-item name="cluster-objective-reports">
            <a href="/app/cluster-objective-reports">
              <span>Cluster objective reports</span>
            </a>
          </paper-item>
        </paper-menu>
      </paper-submenu>

      <paper-item name="analysis">
        <a href="/app/analysis">
          <span>Analysis</span>
        </a>
      </paper-item>
    </paper-menu>
  </template>

  <script>
    Polymer({
      is: 'page-nav',

      behaviors: [
        App.Behaviors.UtilsBehavior,
      ],

      observers: [
        '_selectedChanged(selected)',
      ],

      _selectedChanged: function (selected) {
        var self = this;

        this.async(function () {
          self._forEach('paper-submenu', function (submenu) {
            var isSelected = !!Polymer.dom(submenu).querySelector('[name="' + selected + '"]');

            switch (true) {
              case !submenu.opened && isSelected:
                submenu.open();
                break;
              case submenu.opened && !isSelected:
                submenu.close();
                break;
              default:
                // Do nothing
                break;
            }
          });
        });
      },

      attached: function () {
        // Don't toggle submenus
        this._forEach('.menu-trigger', function (trigger) {
          trigger.addEventListener('tap', function (e) {
            if (Polymer.dom(trigger).parentNode.opened) {
              e.stopPropagation();
            }
          });
        });
      },
    });
  </script>
</dom-module>
