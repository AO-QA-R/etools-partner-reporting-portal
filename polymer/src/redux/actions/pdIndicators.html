<link rel="import" href="../../../bower_components/promise-polyfill/promise-polyfill-lite.html">

<link rel="import" href="../../constants.html">

<script>
  (function () {
    'use strict';

    App.Actions = App.Actions || {};

    App.Actions.PDIndicators = {
      fetch: function (indicatorsThunk, pdId) {
        return function (dispatch) {
          dispatch(App.Actions.PDIndicators.loadingStart(pdId));

          return indicatorsThunk()
              .then(function (res) {
                var indicatorData = res.data;

                dispatch(App.Actions.PDIndicators.set(pdId, indicatorData.results));
                dispatch(App.Actions.PDIndicators.setCount(pdId, indicatorData.count));
                dispatch(App.Actions.PDIndicators.loadingStop(pdId));
              })
              .catch(function (err) {
                dispatch(App.Actions.PDIndicators.loadingStop(pdId));

                return Promise.reject(err);
              });
        };
      },

      set: function (pdId, indicators) {
        return {
          type: App.Constants.SET_PD_INDICATORS,
          pdId: pdId,
          indicators: indicators,
        };
      },

      setCount: function (pdId, count) {
        return {
          type: App.Constants.SET_PD_INDICATORS_COUNT,
          pdId: pdId,
          count: count,
        };
      },

      loading: function (pdId, loading) {
        return {
          type: App.Constants.SET_PD_INDICATORS_LOADING,
          pdId: pdId,
          loading: loading,
        };
      },

      loadingStart: function (pdId) {
        return App.Actions.PDIndicators.loading(pdId, true);
      },

      loadingStop: function (pdId) {
        return App.Actions.PDIndicators.loading(pdId, false);
      },
    };
  }());
</script>
